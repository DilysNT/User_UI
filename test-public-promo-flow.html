<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Public Promo Code Flow</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .step { background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 15px; margin: 10px 0; }
        .flow-demo { border: 2px solid #10b981; border-radius: 12px; padding: 20px; margin: 15px 0; }
        .promo-card { background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 20px; border-radius: 12px; margin: 10px 0; }
        .promo-code { font-size: 24px; font-weight: bold; letter-spacing: 2px; text-align: center; margin: 10px 0; }
        button { padding: 12px 24px; background: #0ea5e9; color: white; border: none; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 16px; }
        button:hover { background: #0284c7; }
        .success { background: #f0fdf4; color: #166534; padding: 10px; border-radius: 6px; margin: 10px 0; }
        .info { background: #fef3c7; color: #92400e; padding: 10px; border-radius: 6px; margin: 10px 0; }
        .highlight { background: #ffe4e6; border: 2px solid #f43f5e; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .demo-screen { background: #1f2937; color: white; padding: 15px; border-radius: 8px; font-family: monospace; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ« Test Public Promo Code Flow</h1>
        
        <div class="section">
            <h2>ğŸ“‹ Overview - Quy trÃ¬nh hoÃ n chá»‰nh</h2>
            <div class="step">1. User vÃ o Home page â†’ Tháº¥y section "MÃ£ Giáº£m GiÃ¡ Äáº·c Biá»‡t"</div>
            <div class="step">2. Click "Sao chÃ©p" hoáº·c "Sá»­ dá»¥ng ngay" â†’ MÃ£ Ä‘Æ°á»£c lÆ°u vÃ o localStorage</div>
            <div class="step">3. Redirect Ä‘áº¿n /search â†’ TÃ¬m tour vÃ  chá»n tour</div>
            <div class="step">4. VÃ o trang Booking â†’ MÃ£ tá»± Ä‘á»™ng Ä‘iá»n vÃ  Ã¡p dá»¥ng</div>
            <div class="step">5. User tháº¥y giÃ¡ Ä‘Ã£ giáº£m vÃ  hoÃ n thÃ nh Ä‘áº·t tour</div>
        </div>

        <div class="section">
            <h2>ğŸ¯ Demo Public Promo Codes</h2>
            
            <div class="flow-demo">
                <h3>ğŸ“± Home Page - Public Promo Section</h3>
                
                <div class="promo-card">
                    <div style="text-align: center;">
                        <h4>ğŸ‰ MÃ£ chÃ o má»«ng khÃ¡ch má»›i</h4>
                        <p>Giáº£m ngay 15% cho Ä‘Æ¡n hÃ ng Ä‘áº§u tiÃªn</p>
                        <div class="promo-code" id="welcome-code">WELCOME2025</div>
                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                            <button onclick="copyPromoCode('WELCOME2025')" style="background: rgba(255,255,255,0.2);">
                                ğŸ“‹ Sao chÃ©p mÃ£
                            </button>
                            <button onclick="usePromoCode('WELCOME2025')" style="background: rgba(255,255,255,0.3);">
                                ğŸš€ Sá»­ dá»¥ng ngay
                            </button>
                        </div>
                    </div>
                </div>

                <div class="promo-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <div style="text-align: center;">
                        <h4>â˜€ï¸ Khuyáº¿n mÃ£i mÃ¹a hÃ¨</h4>
                        <p>Giáº£m 20% cho táº¥t cáº£ tour du lá»‹ch biá»ƒn</p>
                        <div class="promo-code" id="summer-code">SUMMER2025</div>
                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                            <button onclick="copyPromoCode('SUMMER2025')" style="background: rgba(255,255,255,0.2);">
                                ğŸ“‹ Sao chÃ©p mÃ£
                            </button>
                            <button onclick="usePromoCode('SUMMER2025')" style="background: rgba(255,255,255,0.3);">
                                ğŸš€ Sá»­ dá»¥ng ngay
                            </button>
                        </div>
                    </div>
                </div>

                <div class="promo-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                    <div style="text-align: center;">
                        <h4>âš¡ Flash Sale cuá»‘i tuáº§n</h4>
                        <p>Giáº£m 25% chá»‰ trong 3 ngÃ y</p>
                        <div class="promo-code" id="flash-code">FLASH50</div>
                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                            <button onclick="copyPromoCode('FLASH50')" style="background: rgba(255,255,255,0.2);">
                                ğŸ“‹ Sao chÃ©p mÃ£
                            </button>
                            <button onclick="usePromoCode('FLASH50')" style="background: rgba(255,255,255,0.3);">
                                ğŸš€ Sá»­ dá»¥ng ngay
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ”„ Test Flow Actions</h2>
            
            <div class="highlight">
                <h3>ğŸ’¡ Test cÃ¡c scenario:</h3>
                <button onclick="testFullFlow()">ğŸ§ª Test toÃ n bá»™ flow</button>
                <button onclick="simulateBookingPage()">ğŸ“ Simulate Booking Page</button>
                <button onclick="clearStoredData()">ğŸ—‘ï¸ Clear stored data</button>
                <button onclick="checkStoredPromo()">ğŸ‘€ Check stored promo</button>
            </div>

            <div id="test-results" class="demo-screen"></div>
        </div>

        <div class="section">
            <h2>ğŸ“Š LocalStorage Integration</h2>
            <div class="info">
                <strong>Key:</strong> <code>copiedPromoCode</code><br>
                <strong>Purpose:</strong> LÆ°u mÃ£ promo khi user copy tá»« Home page<br>
                <strong>Auto-apply:</strong> Tá»± Ä‘á»™ng Ã¡p dá»¥ng khi vÃ o Booking page
            </div>
            
            <div class="demo-screen" id="localStorage-status">
                Checking localStorage...
            </div>
        </div>

        <div class="section">
            <h2>âœ… Expected Behavior</h2>
            <div class="success">
                <h4>ğŸ¯ TrÃªn Home Page:</h4>
                <ul>
                    <li>âœ… Hiá»ƒn thá»‹ section mÃ£ giáº£m giÃ¡ vá»›i 4 loáº¡i mÃ£</li>
                    <li>âœ… Button "Sao chÃ©p" â†’ Copy vÃ o clipboard + localStorage</li>
                    <li>âœ… Button "Sá»­ dá»¥ng ngay" â†’ Copy + redirect /search</li>
                    <li>âœ… Progress bar hiá»ƒn thá»‹ sá»‘ lÆ°á»£ng Ä‘Ã£ sá»­ dá»¥ng</li>
                </ul>
            </div>

            <div class="success">
                <h4>ğŸ¯ TrÃªn Booking Page:</h4>
                <ul>
                    <li>âœ… Tá»± Ä‘á»™ng kiá»ƒm tra localStorage cÃ³ mÃ£ nÃ o khÃ´ng</li>
                    <li>âœ… Tá»± Ä‘á»™ng Ä‘iá»n mÃ£ vÃ o input field</li>
                    <li>âœ… Tá»± Ä‘á»™ng gá»i API validate vÃ  Ã¡p dá»¥ng mÃ£</li>
                    <li>âœ… Hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ nh cÃ´ng</li>
                    <li>âœ… Clear mÃ£ tá»« localStorage sau khi Ã¡p dá»¥ng</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>ğŸš€ Implementation Benefits</h2>
            <div class="step">ğŸ“ˆ <strong>TÄƒng conversion:</strong> User dá»… dÃ ng access vÃ  sá»­ dá»¥ng mÃ£ giáº£m giÃ¡</div>
            <div class="step">ğŸ¯ <strong>Reduce friction:</strong> KhÃ´ng cáº§n nháº­p manual, tá»± Ä‘á»™ng Ã¡p dá»¥ng</div>
            <div class="step">ğŸ’¡ <strong>Marketing tool:</strong> Attract visitors vá»›i mÃ£ public háº¥p dáº«n</div>
            <div class="step">ğŸ”„ <strong>User experience:</strong> Seamless flow tá»« home â†’ booking</div>
        </div>
    </div>

    <script>
        function copyPromoCode(code) {
            // Copy to clipboard
            navigator.clipboard.writeText(code).then(() => {
                // Store in localStorage
                localStorage.setItem('copiedPromoCode', code);
                
                // Update UI
                updateTestResults(`âœ… Copied "${code}" to clipboard and localStorage`);
                checkStoredPromo();
                
                // Show success feedback
                showSuccessMessage(`ÄÃ£ sao chÃ©p mÃ£ ${code}!`);
            }).catch(err => {
                updateTestResults(`âŒ Failed to copy: ${err}`);
            });
        }

        function usePromoCode(code) {
            // Copy to clipboard and localStorage
            navigator.clipboard.writeText(code).then(() => {
                localStorage.setItem('copiedPromoCode', code);
                updateTestResults(`ğŸš€ Using "${code}" - would redirect to /search`);
                checkStoredPromo();
                showSuccessMessage(`Sá»­ dá»¥ng mÃ£ ${code} - chuyá»ƒn Ä‘áº¿n trang tÃ¬m tour...`);
                
                // Simulate redirect (in real app: window.location.href = '/search')
                setTimeout(() => {
                    alert('Trong á»©ng dá»¥ng thá»±c táº¿, báº¡n sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n trang /search Ä‘á»ƒ tÃ¬m tour!');
                }, 1000);
            });
        }

        function testFullFlow() {
            updateTestResults('ğŸ§ª Testing full promo code flow...\n');
            
            // Step 1: Simulate copy promo from home
            const testCode = 'WELCOME2025';
            localStorage.setItem('copiedPromoCode', testCode);
            updateTestResults(`Step 1: âœ… Stored "${testCode}" in localStorage\n`);
            
            // Step 2: Simulate navigation to booking page
            setTimeout(() => {
                updateTestResults(`Step 2: âœ… User navigates to booking page\n`);
                
                // Step 3: Simulate booking page auto-apply
                setTimeout(() => {
                    const storedCode = localStorage.getItem('copiedPromoCode');
                    if (storedCode) {
                        updateTestResults(`Step 3: âœ… Booking page detects stored code: "${storedCode}"\n`);
                        updateTestResults(`Step 4: âœ… Auto-applying promo code...\n`);
                        
                        // Simulate successful application
                        setTimeout(() => {
                            localStorage.removeItem('copiedPromoCode');
                            updateTestResults(`Step 5: âœ… Promo applied successfully, removed from localStorage\n`);
                            updateTestResults(`ğŸ‰ Flow completed successfully!`);
                            checkStoredPromo();
                        }, 1000);
                    }
                }, 1000);
            }, 1000);
        }

        function simulateBookingPage() {
            updateTestResults('ğŸ“ Simulating Booking page behavior...\n');
            
            const storedCode = localStorage.getItem('copiedPromoCode');
            if (storedCode) {
                updateTestResults(`âœ… Found stored promo code: "${storedCode}"\n`);
                updateTestResults(`ğŸ”„ Auto-filling promo input field...\n`);
                updateTestResults(`ğŸ“¡ Calling API to validate promo...\n`);
                
                setTimeout(() => {
                    updateTestResults(`âœ… Promo validation successful!\n`);
                    updateTestResults(`ğŸ’° Discount applied: 15% off\n`);
                    updateTestResults(`ğŸ—‘ï¸ Clearing stored promo code...\n`);
                    localStorage.removeItem('copiedPromoCode');
                    checkStoredPromo();
                }, 2000);
            } else {
                updateTestResults(`âŒ No stored promo code found\n`);
                updateTestResults(`â„¹ï¸  Normal booking flow continues...`);
            }
        }

        function clearStoredData() {
            localStorage.removeItem('copiedPromoCode');
            updateTestResults('ğŸ—‘ï¸ Cleared all stored promo data');
            checkStoredPromo();
        }

        function checkStoredPromo() {
            const storedCode = localStorage.getItem('copiedPromoCode');
            const statusDiv = document.getElementById('localStorage-status');
            
            if (storedCode) {
                statusDiv.innerHTML = `
âœ… Stored Promo Code: "${storedCode}"
ğŸ”„ Status: Ready for auto-apply on booking page
ğŸ“… Stored at: ${new Date().toLocaleString()}
                `;
                statusDiv.style.background = '#065f46';
            } else {
                statusDiv.innerHTML = `
âŒ No promo code stored
â„¹ï¸  Status: No auto-apply available
ğŸ“ Action: User needs to copy a promo code first
                `;
                statusDiv.style.background = '#1f2937';
            }
        }

        function updateTestResults(message) {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML += message + '\n';
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function showSuccessMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success';
            messageDiv.textContent = message;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.right = '20px';
            messageDiv.style.zIndex = '1000';
            messageDiv.style.padding = '15px';
            messageDiv.style.borderRadius = '8px';
            messageDiv.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                document.body.removeChild(messageDiv);
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkStoredPromo();
            updateTestResults('ğŸš€ Public Promo Code Test Environment Ready\n');
            updateTestResults('ğŸ’¡ Try copying a promo code and testing the flow!\n');
        });

        // Auto-refresh localStorage status every 5 seconds
        setInterval(checkStoredPromo, 5000);
    </script>
</body>
</html>
