<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug URL Parameters</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .result { background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .highlight { background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔗 Debug URL Parameters</h1>
        
        <div class="highlight">
            <h3>Expected URL (based on user's search):</h3>
            <div>http://localhost:3000/search?destination=Đà Lạt&departure=TP.Hồ Chí Minh</div>
        </div>
        
        <div class="result">
            <h3>🔍 Decoded Parameters:</h3>
            <div id="params"></div>
        </div>

        <div class="result">
            <h3>🎯 Test Search Logic:</h3>
            <button onclick="testSearchLogic()">Test with Sample Data</button>
            <div id="searchTest"></div>
        </div>
    </div>

    <script>
        // Simulate URL parameters
        const testURL = "http://localhost:3000/search?destination=Đà%20Lạt&departure=TP.Hồ%20Chí%20Minh";
        const url = new URL(testURL);
        const params = new URLSearchParams(url.search);
        
        const destination = params.get("destination") || "";
        const departure = params.get("departure") || "";
        
        document.getElementById('params').innerHTML = `
            <div><strong>destination:</strong> "${destination}"</div>
            <div><strong>departure:</strong> "${departure}"</div>
            <div><strong>Raw URL search:</strong> ${url.search}</div>
        `;
        
        function testSearchLogic() {
            // Sample tour data (similar to what API might return)
            const sampleTours = [
                {
                    id: "1",
                    name: "Tour Đà Lạt 3N2Đ",
                    destination: "Đà Lạt",
                    location: "Đà Lạt",
                    departure_location: "TP.Hồ Chí Minh"
                },
                {
                    id: "2", 
                    name: "Du lịch Đà Lạt từ TPHCM",
                    destination: "Da Lat",
                    location: "Dalat",
                    departure_location: "Ho Chi Minh City"
                },
                {
                    id: "3",
                    name: "Khám phá Đà Lạt",
                    // No destination field
                    location: "Đà Lạt, Lâm Đồng",
                    departure_location: "Thành phố Hồ Chí Minh"
                }
            ];
            
            // Test different search strategies
            const strategies = [
                {
                    name: "Exact match destination",
                    filter: tour => tour.destination && tour.destination.toLowerCase() === destination.toLowerCase()
                },
                {
                    name: "Contains in destination",
                    filter: tour => tour.destination && tour.destination.toLowerCase().includes(destination.toLowerCase())
                },
                {
                    name: "Contains in location",
                    filter: tour => tour.location && tour.location.toLowerCase().includes(destination.toLowerCase())
                },
                {
                    name: "Contains in name",
                    filter: tour => tour.name && tour.name.toLowerCase().includes(destination.toLowerCase())
                },
                {
                    name: "Any field contains",
                    filter: tour => JSON.stringify(tour).toLowerCase().includes(destination.toLowerCase())
                }
            ];
            
            let results = `
                <h4>Search Parameters:</h4>
                <div><strong>destination:</strong> "${destination}"</div>
                <div><strong>departure:</strong> "${departure}"</div>
                <h4>Test Results:</h4>
            `;
            
            strategies.forEach(strategy => {
                const matches = sampleTours.filter(strategy.filter);
                results += `
                    <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <strong>${strategy.name}:</strong> ${matches.length} tours
                        ${matches.length > 0 ? `<pre>${JSON.stringify(matches, null, 2)}</pre>` : ''}
                    </div>
                `;
            });
            
            // Test departure filter
            const destinationMatches = sampleTours.filter(tour => 
                (tour.destination && tour.destination.toLowerCase().includes(destination.toLowerCase())) ||
                (tour.location && tour.location.toLowerCase().includes(destination.toLowerCase())) ||
                (tour.name && tour.name.toLowerCase().includes(destination.toLowerCase()))
            );
            
            const finalMatches = destinationMatches.filter(tour =>
                tour.departure_location && tour.departure_location.toLowerCase().includes(departure.toLowerCase())
            );
            
            results += `
                <div style="margin: 20px 0; padding: 15px; background: #e9ecef; border-radius: 5px;">
                    <h4>🎯 Final Search Result (Combined Filters):</h4>
                    <div><strong>After destination filter:</strong> ${destinationMatches.length} tours</div>
                    <div><strong>After departure filter:</strong> ${finalMatches.length} tours</div>
                    ${finalMatches.length > 0 ? `<pre>${JSON.stringify(finalMatches, null, 2)}</pre>` : '<div style="color: red;">❌ No tours found!</div>'}
                </div>
            `;
            
            document.getElementById('searchTest').innerHTML = results;
        }
    </script>
</body>
</html>
