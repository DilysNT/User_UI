<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Handling & Loading Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .demo-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .demo-card { border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; background: #f9fafb; }
        .demo-card h3 { margin: 0 0 15px 0; color: #374151; }
        button { padding: 12px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 14px; }
        button:hover { background: #2563eb; }
        button.danger { background: #ef4444; }
        button.danger:hover { background: #dc2626; }
        button.warning { background: #f59e0b; }
        button.warning:hover { background: #d97706; }
        .result { background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #6b7280; }
        .error { border-left-color: #ef4444; background: #fef2f2; color: #991b1b; }
        .success { border-left-color: #10b981; background: #f0fdf4; color: #065f46; }
        .warning { border-left-color: #f59e0b; background: #fffbeb; color: #92400e; }
        .loading-demo { text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px; }
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .progress-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.3); border-radius: 4px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: white; border-radius: 4px; transition: width 0.3s ease; }
        .toast-demo { position: relative; height: 200px; background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 8px; overflow: hidden; }
        .toast { position: absolute; top: 10px; right: 10px; background: white; border-left: 4px solid #ef4444; border-radius: 8px; padding: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 300px; transform: translateX(100%); transition: transform 0.3s ease; }
        .toast.show { transform: translateX(0); }
        .code-block { background: #1f2937; color: #f9fafb; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; overflow-x: auto; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® Error Handling & Loading Improvements</h1>
        
        <div class="section">
            <h2>üìä Issues Fixed</h2>
            <div class="result success">
                <strong>‚úÖ Auth Component Infinite Loop Fixed:</strong><br>
                Fixed useEffect without dependency array causing infinite re-renders
            </div>
            <div class="result success">
                <strong>‚úÖ Error Boundary Added:</strong><br>
                Catch errors gracefully with retry functionality and user-friendly UI
            </div>
            <div class="result success">
                <strong>‚úÖ Improved Loading States:</strong><br>
                Better loading indicators with timeout handling and progress tracking
            </div>
            <div class="result success">
                <strong>‚úÖ Error Toast System:</strong><br>
                Non-intrusive error notifications with categorization
            </div>
        </div>

        <div class="section">
            <h2>üéØ Demo Components</h2>
            
            <div class="demo-grid">
                <!-- Error Boundary Demo -->
                <div class="demo-card">
                    <h3>üõ°Ô∏è Error Boundary</h3>
                    <p>Demonstrates how errors are caught and handled gracefully:</p>
                    <button onclick="simulateError('component')" class="danger">Trigger Component Error</button>
                    <button onclick="simulateError('network')" class="warning">Network Error</button>
                    <button onclick="simulateError('auth')" class="danger">Auth Error</button>
                    <div id="error-result" class="result" style="display: none;"></div>
                </div>

                <!-- Loading States Demo -->
                <div class="demo-card">
                    <h3>‚è≥ Loading States</h3>
                    <p>Various loading indicators and timeout handling:</p>
                    <button onclick="simulateLoading('spinner')">Spinner Loading</button>
                    <button onclick="simulateLoading('progress')">Progress Loading</button>
                    <button onclick="simulateLoading('timeout')">Timeout Demo</button>
                    <div id="loading-demo" class="loading-demo" style="display: none;">
                        <div class="spinner"></div>
                        <p id="loading-text">ƒêang t·∫£i...</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
                        </div>
                        <p id="loading-time">0s</p>
                    </div>
                </div>

                <!-- Error Toast Demo -->
                <div class="demo-card">
                    <h3>üçû Error Toasts</h3>
                    <p>Non-intrusive error notifications:</p>
                    <button onclick="showToast('network')">Network Toast</button>
                    <button onclick="showToast('validation')">Validation Toast</button>
                    <button onclick="showToast('server')">Server Toast</button>
                    <div class="toast-demo">
                        <div id="demo-toast" class="toast">
                            <div style="display: flex; align-items: start;">
                                <div style="margin-right: 10px;">
                                    <span id="toast-icon">‚ö†Ô∏è</span>
                                </div>
                                <div style="flex: 1;">
                                    <p style="margin: 0; font-weight: bold;" id="toast-title">Error Title</p>
                                    <p style="margin: 5px 0 0 0; font-size: 14px;" id="toast-message">Error message here</p>
                                </div>
                                <button onclick="hideToast()" style="background: none; border: none; color: #6b7280; cursor: pointer; padding: 0; margin-left: 10px;">‚úï</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üíª Implementation Code</h2>
            
            <h3>üîß Auth Component Fix:</h3>
            <div class="code-block">
// Before (causing infinite loop):
useEffect(() => {
  setRenderCounter(prev => prev + 1);
  console.log("üîÑ Auth component render #", renderCounter + 1);
}); // ‚ùå No dependency array

// After (fixed):
useEffect(() => {
  setRenderCounter(prev => prev + 1);
  console.log("üîÑ Auth component render #", renderCounter + 1);
}, [showForgot, showForgotOtp, showNewPassword]); // ‚úÖ Proper dependencies
            </div>

            <h3>üõ°Ô∏è Error Boundary Usage:</h3>
            <div class="code-block">
// app/layout.tsx
import ImprovedErrorBoundary from "@/components/ImprovedErrorBoundary";

export default function RootLayout({ children }) {
  return (
    &lt;html&gt;
      &lt;body&gt;
        &lt;ImprovedErrorBoundary&gt;
          {children}
        &lt;/ImprovedErrorBoundary&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}
            </div>

            <h3>‚è≥ Loading Hook Usage:</h3>
            <div class="code-block">
// Using improved loading
import { LoadingSpinner, FullPageLoading } from "@/components/ImprovedLoading";

function MyComponent() {
  const [loading, setLoading] = useState(true);
  
  if (loading) {
    return (
      &lt;LoadingSpinner 
        text="ƒêang t·∫£i d·ªØ li·ªáu..."
        showProgress={true}
        timeout={10000}
        onTimeout={() => console.warn('Loading too slow')}
      /&gt;
    );
  }
  
  return &lt;div&gt;Content loaded!&lt;/div&gt;;
}
            </div>

            <h3>üçû Error Toast Hook:</h3>
            <div class="code-block">
// Using error handling hook
import useErrorHandler from "@/hooks/useErrorHandler";

function MyComponent() {
  const { error, setError, clearError, retryAction } = useErrorHandler(3, async () => {
    // Retry logic here
    await fetchData();
  });

  const handleApiCall = async () => {
    try {
      await apiCall();
    } catch (err) {
      setError(err); // Automatically categorizes and displays error
    }
  };

  return (
    &lt;div&gt;
      {error && (
        &lt;div className="error-banner"&gt;
          {error.message}
          {canRetry && &lt;button onClick={retryAction}&gt;Retry&lt;/button&gt;}
        &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
}
            </div>
        </div>

        <div class="section">
            <h2>üéØ Benefits of Improvements</h2>
            <div class="demo-grid">
                <div class="result success">
                    <strong>üöÄ Performance:</strong><br>
                    - Fixed infinite loops<br>
                    - Reduced unnecessary re-renders<br>
                    - Optimized error handling
                </div>
                <div class="result success">
                    <strong>üë§ User Experience:</strong><br>
                    - Graceful error recovery<br>
                    - Clear loading feedback<br>
                    - Non-blocking error notifications
                </div>
                <div class="result success">
                    <strong>üõ†Ô∏è Developer Experience:</strong><br>
                    - Better error debugging<br>
                    - Reusable components<br>
                    - Type-safe error handling
                </div>
            </div>
        </div>
    </div>

    <script>
        let loadingTimeout;
        let progressInterval;

        function simulateError(type) {
            const errorMessages = {
                component: 'Component render error - This would be caught by Error Boundary',
                network: 'Failed to fetch data from server',
                auth: 'User authentication failed - Please login again'
            };

            const resultDiv = document.getElementById('error-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result error';
            resultDiv.innerHTML = `
                <strong>üö® ${type.toUpperCase()} ERROR:</strong><br>
                ${errorMessages[type]}<br>
                <button onclick="clearError()" style="margin-top: 10px; background: #10b981;">Clear Error</button>
            `;
        }

        function clearError() {
            document.getElementById('error-result').style.display = 'none';
        }

        function simulateLoading(type) {
            const loadingDiv = document.getElementById('loading-demo');
            const loadingText = document.getElementById('loading-text');
            const progressFill = document.getElementById('progress-fill');
            const loadingTime = document.getElementById('loading-time');

            loadingDiv.style.display = 'block';
            
            let startTime = Date.now();
            let progress = 0;

            if (type === 'progress') {
                loadingText.textContent = 'ƒêang t·∫£i v·ªõi progress...';
                progressInterval = setInterval(() => {
                    progress += 2;
                    progressFill.style.width = progress + '%';
                    
                    const elapsed = Math.floor((Date.now() - startTime) / 1000);
                    loadingTime.textContent = elapsed + 's';
                    
                    if (progress >= 100) {
                        clearInterval(progressInterval);
                        setTimeout(() => {
                            loadingDiv.style.display = 'none';
                            progressFill.style.width = '0%';
                        }, 500);
                    }
                }, 100);
            } else if (type === 'timeout') {
                loadingText.textContent = 'ƒêang t·∫£i... (s·∫Ω timeout sau 5s)';
                loadingTimeout = setTimeout(() => {
                    loadingText.textContent = '‚ö†Ô∏è T·∫£i d·ªØ li·ªáu ch·∫≠m h∆°n b√¨nh th∆∞·ªùng';
                    loadingText.style.color = '#f59e0b';
                    setTimeout(() => {
                        loadingDiv.style.display = 'none';
                        loadingText.style.color = 'white';
                    }, 2000);
                }, 5000);
                
                const timeInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - startTime) / 1000);
                    loadingTime.textContent = elapsed + 's';
                }, 1000);
                
                setTimeout(() => clearInterval(timeInterval), 7000);
            } else {
                loadingText.textContent = 'ƒêang t·∫£i v·ªõi spinner...';
                setTimeout(() => {
                    loadingDiv.style.display = 'none';
                }, 3000);
            }
        }

        function showToast(type) {
            const toast = document.getElementById('demo-toast');
            const icon = document.getElementById('toast-icon');
            const title = document.getElementById('toast-title');
            const message = document.getElementById('toast-message');

            const toastData = {
                network: {
                    icon: 'üì°',
                    title: 'L·ªói k·∫øt n·ªëi m·∫°ng',
                    message: 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.'
                },
                validation: {
                    icon: '‚ö†Ô∏è',
                    title: 'D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá',
                    message: 'Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin ƒë√£ nh·∫≠p.'
                },
                server: {
                    icon: 'üîß',
                    title: 'L·ªói m√°y ch·ªß',
                    message: 'M√°y ch·ªß ƒëang g·∫∑p s·ª± c·ªë. Vui l√≤ng th·ª≠ l·∫°i sau.'
                }
            };

            icon.textContent = toastData[type].icon;
            title.textContent = toastData[type].title;
            message.textContent = toastData[type].message;

            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 5000);
        }

        function hideToast() {
            document.getElementById('demo-toast').classList.remove('show');
        }

        // Auto-clear loading demos on page leave
        window.addEventListener('beforeunload', () => {
            clearTimeout(loadingTimeout);
            clearInterval(progressInterval);
        });
    </script>
</body>
</html>
