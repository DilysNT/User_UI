<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test Copy Function - Profile Modal</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { background: white; border-radius: 12px; padding: 24px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .promo-card { 
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            background: #f9fafb;
        }
        .promo-card.active { border-color: #10b981; background: #ecfdf5; }
        .promo-card.used { border-color: #6b7280; background: #f3f4f6; }
        .promo-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .promo-code { font-size: 18px; font-weight: bold; color: #0d9488; margin-bottom: 8px; }
        .status-badge { 
            padding: 4px 8px; 
            border-radius: 12px; 
            font-size: 12px; 
            font-weight: 500; 
        }
        .status-active { background: #d1fae5; color: #065f46; }
        .status-used { background: #f3f4f6; color: #374151; }
        .copy-btn {
            background: #0d9488;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .copy-btn:hover { background: #0f766e; }
        .copy-btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .test-log { 
            background: #1f2937; 
            color: #f9fafb; 
            padding: 16px; 
            border-radius: 8px; 
            font-family: monospace; 
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 16px;
        }
        .success { background: #d1fae5; border: 1px solid #10b981; border-radius: 8px; padding: 16px; margin: 16px 0; color: #065f46; }
        .error { background: #fee2e2; border: 1px solid #ef4444; border-radius: 8px; padding: 16px; margin: 16px 0; color: #dc2626; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Copy Function - Profile Modal</h1>
        
        <div class="section">
            <h2>üìã Copy Function Test:</h2>
            <p>ƒê√¢y l√† test ƒë·ªÉ ki·ªÉm tra t·∫°i sao n√∫t "Sao ch√©p" trong ProfileModal kh√¥ng ho·∫°t ƒë·ªông.</p>
            
            <!-- Test Data -->
            <div class="promo-card active">
                <div class="promo-header">
                    <div>
                        <div class="promo-code">JULY2507</div>
                        <span class="status-badge status-active">C√≥ th·ªÉ s·ª≠ d·ª•ng</span>
                        <p style="margin: 8px 0; color: #374151;">Gi·∫£m gi√° cu·ªëi th√°ng cho c√°c du kh√°ch v·ª´a h·∫øt ti·ªÅn l∆∞∆°ng</p>
                        <div style="font-size: 12px; color: #6b7280;">
                            <div><strong>Gi·∫£m:</strong> 500.000‚Ç´</div>
                            <div><strong>H·∫øt h·∫°n:</strong> 01/08/2025</div>
                        </div>
                    </div>
                    <button 
                        class="copy-btn" 
                        onclick="testCopyFunction('JULY2507')"
                        id="copy-btn-1"
                    >
                        Sao ch√©p
                    </button>
                </div>
            </div>
            
            <div class="promo-card active">
                <div class="promo-header">
                    <div>
                        <div class="promo-code">SUMMER2025</div>
                        <span class="status-badge status-active">C√≥ th·ªÉ s·ª≠ d·ª•ng</span>
                        <p style="margin: 8px 0; color: #374151;">Gi·∫£m gi√° 10% cho t·∫•t c·∫£ c√°c tour kh·ªüi h√†nh trong th√°ng 7 v√† 8</p>
                        <div style="font-size: 12px; color: #6b7280;">
                            <div><strong>Gi·∫£m:</strong> 10%</div>
                            <div><strong>H·∫øt h·∫°n:</strong> 31/08/2025</div>
                        </div>
                    </div>
                    <button 
                        class="copy-btn" 
                        onclick="testCopyFunction('SUMMER2025')"
                        id="copy-btn-2"
                    >
                        Sao ch√©p
                    </button>
                </div>
            </div>
            
            <div class="promo-card used">
                <div class="promo-header">
                    <div>
                        <div class="promo-code">USED123</div>
                        <span class="status-badge status-used">ƒê√£ s·ª≠ d·ª•ng</span>
                        <p style="margin: 8px 0; color: #374151;">M√£ gi·∫£m gi√° ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng</p>
                        <div style="font-size: 12px; color: #6b7280;">
                            <div><strong>Gi·∫£m:</strong> 100.000‚Ç´</div>
                            <div><strong>H·∫øt h·∫°n:</strong> 15/07/2025</div>
                        </div>
                    </div>
                    <!-- No copy button for used codes -->
                </div>
            </div>
            
            <div id="result"></div>
            <div class="test-log" id="log"></div>
        </div>

        <div class="section">
            <h2>üîß Debug Information:</h2>
            <div id="debug-info">
                <p><strong>User Agent:</strong> <span id="user-agent"></span></p>
                <p><strong>Protocol:</strong> <span id="protocol"></span></p>
                <p><strong>Clipboard API:</strong> <span id="clipboard-support"></span></p>
                <p><strong>execCommand:</strong> <span id="execcommand-support"></span></p>
            </div>
        </div>

        <div class="section">
            <h2>üéØ Expected Behavior:</h2>
            <ul>
                <li>‚úÖ Click "Sao ch√©p" button</li>
                <li>‚úÖ Code should be copied to clipboard</li>
                <li>‚úÖ Success message should appear</li>
                <li>‚úÖ Console should log the operation</li>
                <li>‚ö†Ô∏è If Clipboard API fails, fallback to execCommand</li>
                <li>‚ö†Ô∏è If both fail, show alert with code</li>
            </ul>
        </div>
    </div>

    <script>
        // Initialize debug info
        document.getElementById('user-agent').textContent = navigator.userAgent;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('clipboard-support').textContent = 
            navigator.clipboard ? '‚úÖ Available' : '‚ùå Not Available';
        document.getElementById('execcommand-support').textContent = 
            document.queryCommandSupported('copy') ? '‚úÖ Supported' : '‚ùå Not Supported';

        // Log function
        function logMessage(message, type = 'info') {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#3b82f6';
            log.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        // Mock toast function
        function showToast(title, description) {
            const result = document.getElementById('result');
            result.innerHTML = `
                <div class="success">
                    <strong>${title}</strong><br>
                    ${description}
                </div>
            `;
            setTimeout(() => {
                result.innerHTML = '';
            }, 3000);
        }

        // Test copy function (exact replica of ProfileModal logic)
        async function testCopyFunction(promoCode) {
            logMessage(`Copy button clicked for code: ${promoCode}`);
            
            try {
                await navigator.clipboard.writeText(promoCode);
                logMessage('Successfully copied to clipboard using Clipboard API', 'success');
                showToast("ƒê√£ sao ch√©p!", `M√£ "${promoCode}" ƒë√£ ƒë∆∞·ª£c sao ch√©p v√†o clipboard`);
            } catch (error) {
                logMessage(`Clipboard API failed: ${error.message}`, 'error');
                
                // Fallback method using execCommand
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = promoCode;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (successful) {
                        logMessage('Fallback copy successful using execCommand', 'success');
                        showToast("ƒê√£ sao ch√©p!", `M√£ "${promoCode}" ƒë√£ ƒë∆∞·ª£c sao ch√©p v√†o clipboard`);
                    } else {
                        throw new Error('execCommand failed');
                    }
                } catch (fallbackError) {
                    logMessage(`Fallback copy failed: ${fallbackError.message}`, 'error');
                    // Show alert as last resort
                    alert(`M√£ gi·∫£m gi√°: ${promoCode}\n\nVui l√≤ng sao ch√©p th·ªß c√¥ng.`);
                    document.getElementById('result').innerHTML = `
                        <div class="error">
                            <strong>L·ªói sao ch√©p</strong><br>
                            Kh√¥ng th·ªÉ sao ch√©p m√£ "${promoCode}". Vui l√≤ng sao ch√©p th·ªß c√¥ng.
                        </div>
                    `;
                }
            }
        }

        // Test on page load
        logMessage('Page loaded, copy function ready');
        logMessage(`Clipboard API available: ${!!navigator.clipboard}`);
        logMessage(`execCommand supported: ${document.queryCommandSupported('copy')}`);
    </script>
</body>
</html>
